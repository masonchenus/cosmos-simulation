<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmos Simulation - API Documentation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    <style>
        :root {
            --bg-primary: #1a1d23;
            --bg-secondary: #242830;
            --bg-tertiary: #2d323c;
            --bg-hover: #363c47;
            --text-primary: #e4e7eb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --accent-color: #3b82f6;
            --accent-hover: #60a5fa;
            --border-color: #374151;
            --code-bg: #1f2937;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }

        .sidebar-header h1 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-header p {
            font-size: 12px;
            color: var(--text-muted);
        }

        .search-box {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .search-box input {
            width: 100%;
            padding: 10px 14px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .search-box input::placeholder {
            color: var(--text-muted);
        }

        .nav-menu {
            flex: 1;
            overflow-y: auto;
            padding: 12px 0;
        }

        .nav-section {
            margin-bottom: 8px;
        }

        .nav-section-title {
            padding: 8px 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
        }

        .nav-item {
            padding: 10px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.15s;
            font-size: 13px;
            color: var(--text-secondary);
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--bg-tertiary);
            color: var(--accent-color);
            border-left-color: var(--accent-color);
        }

        .nav-item .icon {
            font-size: 14px;
            opacity: 0.7;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 300px;
            padding: 0;
            min-height: 100vh;
        }

        /* Top TOC Bar */
        .top-toc {
            position: sticky;
            top: 0;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 40px;
            z-index: 50;
            display: flex;
            align-items: center;
            gap: 8px;
            overflow-x: auto;
        }

        .top-toc-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            margin-right: 8px;
        }

        .top-toc-link {
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            font-size: 12px;
            color: var(--text-secondary);
            text-decoration: none;
            white-space: nowrap;
            transition: all 0.15s;
        }

        .top-toc-link:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .top-toc-link.active {
            background: var(--accent-color);
            color: white;
        }

        /* Toolbar */
        .toolbar {
            position: fixed;
            top: 70px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 200;
        }

        .toolbar-btn {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.15s;
        }

        .toolbar-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--text-muted);
        }

        .toolbar-btn.primary {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }

        .toolbar-btn.primary:hover {
            background: var(--accent-hover);
        }

        /* Content */
        .content-wrapper {
            padding: 40px 60px;
            max-width: 1000px;
        }

        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            font-size: 13px;
        }

        .breadcrumb a {
            color: var(--accent-color);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .breadcrumb span {
            color: var(--text-muted);
        }

        .file-path {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--bg-tertiary);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-family: monospace;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .file-path .icon {
            opacity: 0.6;
        }

        /* Markdown Content */
        .markdown-content {
            color: var(--text-primary);
        }

        .markdown-content h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 40px 0 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .markdown-content h1:first-child {
            margin-top: 0;
        }

        .markdown-content h2 {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 36px 0 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .markdown-content h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 28px 0 12px;
        }

        .markdown-content h4 {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 24px 0 10px;
        }

        .markdown-content p {
            margin-bottom: 16px;
            color: var(--text-secondary);
        }

        .markdown-content code {
            background: var(--code-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
            font-size: 13px;
            color: #e5e7eb;
        }

        .markdown-content pre {
            background: var(--code-bg);
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 24px 0;
            border: 1px solid var(--border-color);
        }

        .markdown-content pre code {
            background: none;
            padding: 0;
            font-size: 13px;
            line-height: 1.6;
        }

        .markdown-content ul, .markdown-content ol {
            margin: 16px 0;
            padding-left: 24px;
        }

        .markdown-content li {
            margin: 8px 0;
            color: var(--text-secondary);
        }

        .markdown-content blockquote {
            border-left: 4px solid var(--accent-color);
            padding: 16px 20px;
            margin: 24px 0;
            background: var(--bg-tertiary);
            border-radius: 0 8px 8px 0;
        }

        .markdown-content blockquote p {
            margin: 0;
        }

        /* Tables */
        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 24px 0;
            font-size: 14px;
        }

        .markdown-content th,
        .markdown-content td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .markdown-content th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
        }

        .markdown-content tr:hover td {
            background: var(--bg-tertiary);
        }

        .markdown-content td code {
            background: var(--bg-primary);
            padding: 2px 6px;
            border-radius: 3px;
        }

        /* Inline links */
        .markdown-content a {
            color: var(--accent-color);
            text-decoration: none;
        }

        .markdown-content a:hover {
            text-decoration: underline;
        }

        /* Horizontal rule */
        .markdown-content hr {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 32px 0;
        }

        /* Strong */
        .markdown-content strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Diagram placeholders */
        .diagram-container {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 24px;
            margin: 24px 0;
            text-align: center;
        }

        .diagram-placeholder {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 48px 32px;
            color: var(--text-muted);
        }

        .diagram-placeholder svg {
            width: 64px;
            height: 64px;
            margin-bottom: 12px;
            opacity: 0.4;
        }

        .diagram-placeholder p {
            margin: 0;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .diagram-placeholder strong {
            color: var(--text-primary);
        }

        .diagram-caption {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 12px;
        }

        /* Method signatures */
        .method-signature {
            background: var(--code-bg);
            border: 1px solid var(--border-color);
            border-left: 4px solid var(--accent-color);
            border-radius: 0 8px 8px 0;
            padding: 16px 20px;
            margin: 20px 0;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 13px;
        }

        .method-signature .name {
            color: var(--accent-color);
            font-weight: 600;
        }

        /* Info boxes */
        .info-box {
            padding: 16px 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .info-box.note {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .info-box.warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .info-box.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .info-box.tip {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .info-box-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-box.note .info-box-title { color: var(--accent-color); }
        .info-box.warning .info-box-title { color: var(--warning); }
        .info-box.error .info-box-title { color: var(--error); }
        .info-box.tip .info-box-title { color: var(--success); }

        /* Print Styles */
        @media print {
            .sidebar, .toolbar, .top-toc {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .content-wrapper {
                padding: 20px;
            }
            
            body {
                background: white;
                color: #1f2937;
            }
            
            .markdown-content h1, .markdown-content h2, .markdown-content h3 {
                color: #111827;
            }
            
            .markdown-content code, .markdown-content pre {
                background: #f3f4f6;
                color: #1f2937;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .toolbar {
                top: 20px;
            }
            
            .content-wrapper {
                padding: 30px;
            }
        }

        /* Loading */
        .loading {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 300px;
            gap: 16px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-muted);
            font-size: 14px;
        }

        /* Back to top */
        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            z-index: 100;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background: var(--bg-hover);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>üöÄ Cosmos Simulation</h1>
                <p>API Documentation v2.0</p>
            </div>
            
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search docs... (Ctrl+K)">
            </div>
            
            <nav class="nav-menu" id="nav-menu">
                <!-- Populated by JavaScript -->
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Top TOC -->
            <div class="top-toc" id="top-toc">
                <span class="top-toc-label">Quick Jump:</span>
            </div>
            
            <!-- Toolbar -->
            <div class="toolbar">
                <button class="toolbar-btn" onclick="window.print()">
                    <span>üñ®Ô∏è</span> Print / PDF
                </button>
                <button class="toolbar-btn primary" onclick="exportLaTeX()">
                    <span>üìê</span> Export LaTeX
                </button>
                <button class="toolbar-btn" onclick="toggleSidebar()">
                    <span>‚ò∞</span> Toggle
                </button>
            </div>
            
            <!-- Content -->
            <div class="content-wrapper">
                <div class="markdown-content" id="content">
                    <div class="loading">
                        <div class="spinner"></div>
                        <span class="loading-text">Loading documentation...</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Back to top button -->
    <div class="back-to-top" id="back-to-top" onclick="scrollToTop()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 15l-6-6-6 6"/>
        </svg>
    </div>

    <script>
        // Documentation files list
        const DOC_FILES = [
            'API_AstronomicalData',
            'API_PhysicsEngine',
            'API_TimeSystem',
            'API_WebGLRenderer',
            'API_fetchAstronomicalData',
            'API_Integration',
            'API_Architecture',
            'API_Configuration',
            'API_Components',
            'API_Events'
        ];

        let currentDoc = 'API_AstronomicalData';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadDocumentation(currentDoc);
            setupNavigation();
            setupSearch();
            setupKeyboardShortcuts();
        });

        // Load documentation
        async function loadDocumentation(docName) {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                const response = await fetch(`docs/${docName}.md`);
                if (!response.ok) throw new Error('File not found');
                
                let markdown = await response.text();
                
                // Add diagram placeholders
                markdown = enhanceMarkdownWithDiagrams(markdown, docName);
                
                // Convert markdown to HTML
                const html = marked.parse(markdown);
                content.innerHTML = html;
                
                // Update active nav
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.file === docName) {
                        item.classList.add('active');
                    }
                });
                
                currentDoc = docName;
                
                // Scroll to top
                window.scrollTo(0, 0);
            } catch (error) {
                content.innerHTML = `
                    <h1>Error Loading Documentation</h1>
                    <p>Could not load ${docName}.md</p>
                    <p>Error: ${error.message}</p>
                `;
            }
        }

        // Enhance markdown with diagram placeholders
        function enhanceMarkdownWithDiagrams(markdown, docName) {
            const diagrams = {
                'API_Integration': `
<div class="diagram-container">
    <div class="diagram-placeholder">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        <p><strong>System Architecture Diagram</strong></p>
        <p class="diagram-caption">Figure: Component interaction flow between engines</p>
    </div>
</div>
`,
                'API_Architecture': `
<div class="diagram-container">
    <div class="diagram-placeholder">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
        </svg>
        <p><strong>Layer Architecture Diagram</strong></p>
        <p class="diagram-caption">Figure: Application, Engine, Renderer, and Data layers</p>
    </div>
</div>
`,
                'API_PhysicsEngine': `
<div class="diagram-container">
    <div class="diagram-placeholder">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <circle cx="12" cy="12" r="10"/>
        </svg>
        <p><strong>Kepler's Equation Solver Flow</strong></p>
        <p class="diagram-caption">Figure: Newton-Raphson iteration for orbital calculations</p>
    </div>
</div>
`,
                'API_TimeSystem': `
<div class="diagram-container">
    <div class="diagram-placeholder">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
        </svg>
        <p><strong>Time Update Sequence</strong></p>
        <p class="diagram-caption">Figure: TimeSystem.update() flow diagram</p>
    </div>
</div>
`
            };

            // Insert diagrams at appropriate locations
            if (diagrams[docName]) {
                markdown = markdown.replace(
                    /(## System Architecture|## Overview|## Rendering Pipeline)/,
                    `$1\n\n${diagrams[docName]}`
                );
            }

            return markdown;
        }

        // Setup navigation
        function setupNavigation() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    loadDocumentation(item.dataset.file);
                });
            });
        }

        // Setup search
        function setupSearch() {
            const searchInput = document.getElementById('search-input');
            
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                
                if (query.length < 2) return;
                
                document.querySelectorAll('.nav-item').forEach(item => {
                    const text = item.textContent.toLowerCase();
                    item.style.display = text.includes(query) ? 'flex' : 'none';
                });
            });
            
            searchInput.addEventListener('blur', () => {
                setTimeout(() => {
                    searchInput.value = '';
                    document.querySelectorAll('.nav-item').forEach(item => {
                        item.style.display = 'flex';
                    });
                }, 200);
            });
        }

        // Setup keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl+K for search
                if (e.ctrlKey && e.key === 'k') {
                    e.preventDefault();
                    document.getElementById('search-input').focus();
                }
                
                // Ctrl+Number for quick navigation
                if (e.ctrlKey && !isNaN(e.key) && e.key !== '0') {
                    const index = parseInt(e.key) - 1;
                    if (index < DOC_FILES.length) {
                        loadDocumentation(DOC_FILES[index]);
                    }
                }
            });
        }

        // Toggle sidebar
        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('hidden');
            document.querySelector('.main-content').classList.toggle('expanded');
        }

        // Export to LaTeX
        async function exportLaTeX() {
            const content = document.getElementById('content');
            const loading = document.createElement('div');
            loading.innerHTML = '<div class="loading"><p>Generating LaTeX...</p></div>';
            content.innerHTML = '';
            content.appendChild(loading);
            
            let latex = `\\documentclass{article}
\\usepackage[utf8]{inputenc}
\\usepackage{geometry}
\\usepackage{listings}
\\usepackage{xcolor}
\\usepackage{hyperref}
\\usepackage{graphicx}

\\geometry{a4paper, margin=1in}

\\definecolor{codegreen}{rgb}{0,0.6,0}
\\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\\definecolor{codepurple}{rgb}{0.58,0,0.82}
\\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\\lstdefinestyle{mystyle}{
    backgroundcolor=\\color{backcolour},
    commentstyle=\\color{codegreen},
    keywordstyle=\\color{blue},
    numberstyle=\\tiny\\color{codegray},
    stringstyle=\\color{codepurple},
    basicstyle=\\ttfamily\\footnotesize,
    breaklines=true,
    frame=single,
    numbers=left
}

\\lstset{style=mystyle}

\\title{Cosmos Simulation API Documentation}
\\author{Cosmos Simulation Team}
\\date{\\today}

\\begin{document}

\\mpagebreak

`;
            
            // Get all documentation
            for (const docName of DOC_FILES) {
                try {
                    const response = await fetch(`docs/${docName}.md`);
                    const markdown = await response.text();
                    latex += convertMarkdownToLaTeX(markdown, docName);
                    latex += '\\newpage\n\n';
                } catch (error) {
                    console.error(`Error loading ${docName}:`, error);
                }
            }
            
            latex += `\\end{document}`;
            
            // Create downloadable file
            const blob = new Blob([latex], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cosmos-api-docs.tex';
            a.click();
            URL.revokeObjectURL(url);
            
            // Restore content
            loadDocumentation(currentDoc);
        }

        // Convert markdown to LaTeX (simplified)
        function convertMarkdownToLaTeX(markdown, title) {
            let latex = `\\section{${title.replace(/_/g, ' ')}}\n\n`;
            
            // Remove existing LaTeX commands
            markdown = markdown.replace(/\\texttt/g, '');
            
            // Headers
            markdown = markdown.replace(/^### (.+)$/gm, '\\subsubsection{$1}\n');
            markdown = markdown.replace(/^## (.+)$/gm, '\\section{$1}\n');
            
            // Code blocks
            markdown = markdown.replace(/```javascript\n([\s\S]*?)```/g, 
                '\\begin lstlisting\n$1\\end lstlisting\n');
            markdown = markdown.replace(/```bash\n([\s\S]*?)```/g,
                '\\begin lstlisting\n$1\\end lstlisting\n');
            
            // Inline code
            markdown = markdown.replace(/`([^`]+)`/g, '\\texttt{$1}');
            
            // Bold
            markdown = markdown.replace(/\*\*([^*]+)\*\*/g, '\\textbf{$1}');
            
            // Tables (simplified)
            markdown = markdown.replace(/\|(.+)\|/g, (match) => {
                const cells = match.split('|').filter(c => c.trim());
                return cells.map(c => c.trim()).join(' & ') + ' \\\\';
            });
            
            // Clean up markdown syntax
            markdown = markdown.replace(/^- /gm, '\\item ');
            markdown = markdown.replace(/^(\d+)\. /gm, '\\item ');
            
            // Lists
            if (markdown.match(/^- /)) {
                markdown = markdown.replace(/((?:- \w+[\s\S]*?)+)/g, 
                    '\\begin{itemize}\n$1\\end{itemize}\n');
            }
            
            return latex;
        }

        // Print to PDF
        function printToPDF() {
            window.print();
        }
    </script>
</body>
</html>

